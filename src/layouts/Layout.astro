---
import Navigation from '../components/Navigation.astro';

export interface Props {
  title: string;
  description: string;
  image?: string;
}

const { title, description, image = '/images/og-image.jpg' } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.url.origin);
---

<!DOCTYPE html>
<html lang="de">
  <head>
    <!-- Basic Meta Tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    
    <!-- SEO Meta Tags -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={new URL(image, Astro.url.origin)} />
    <meta property="og:locale" content="de_DE" />
    <meta property="og:site_name" content="Unterm Schloss - Ferienwohnung Hambach" />
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={new URL(image, Astro.url.origin)} />
    
    <!-- Additional SEO -->
    <meta name="robots" content="index, follow" />
    <meta name="author" content="Unterm Schloss" />
    <meta name="keywords" content="Ferienwohnung, Hambach, Pfalz, Weinstraße, Hambacher Schloss, Urlaub, Ferienhaus" />
    
    <!-- Font Preconnect - Performance optimiert -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Kritische Fonts preloaden - nur die wirklich benötigten -->
    <link 
      rel="preload" 
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400&family=DM+Sans:wght@300;400;500&display=swap" 
      as="style" 
      onload="this.onload=null;this.rel='stylesheet'"
    />
    
    <!-- Fallback für JavaScript-deaktivierte Browser -->
    <noscript>
      <link 
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400&family=DM+Sans:wght@300;400;500&display=swap" 
        rel="stylesheet"
      />
    </noscript>
    
    <!-- Font-Display Swap für bessere Performance -->
    <style>
      @font-face {
        font-family: 'Playfair Display';
        font-display: swap;
      }
      @font-face {
        font-family: 'DM Sans';
        font-display: swap;
      }
    </style>
    
    <!-- Hero Image Preload -->
    <link 
      rel="preload" 
      as="image" 
      href="/images/01_aussenansicht_fachwerkhaus_haupteingang.jpg"
      fetchpriority="high"
    />
    
    <!-- Schema.org JSON-LD -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "LodgingBusiness",
        "name": "Unterm Schloss - Ferienwohnung Hambach",
        "description": "Charmante Ferienwohnung in historischem Ambiente direkt am Hambacher Schloss",
        "url": "https://unterm-schloss.de",
        "telephone": "+49-172-8049269",
        "email": "eva.dirion@gmx.net",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "Schloßstraße 18",
          "addressLocality": "Hambach an der Weinstraße",
          "postalCode": "67434",
          "addressRegion": "Rheinland-Pfalz",
          "addressCountry": "DE"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": "49.3167",
          "longitude": "8.1167"
        },
        "amenityFeature": [
          {
            "@type": "LocationFeatureSpecification",
            "name": "WiFi",
            "value": true
          },
          {
            "@type": "LocationFeatureSpecification", 
            "name": "Parking",
            "value": true
          },
          {
            "@type": "LocationFeatureSpecification",
            "name": "PetsAllowed", 
            "value": true
          },
          {
            "@type": "LocationFeatureSpecification",
            "name": "Kitchen",
            "value": true
          }
        ],
        "checkinTime": "15:00",
        "checkoutTime": "10:00",
        "petsAllowed": true,
        "starRating": {
          "@type": "Rating",
          "ratingValue": "5"
        }
      }
    </script>
  </head>
  
  <body>
    <Navigation currentPath={Astro.url.pathname} />
    <slot />
    
    <!-- Global Styles -->
    <style is:global>
      @import '../styles/global.css';
      @import '../styles/hero-precision.css';
      
      body {
        padding-top: 80px; /* Account for fixed nav height */
      }

      @media (max-width: 768px) {
        body {
          padding-top: 70px; /* Slightly less on mobile */
        }
      }
    </style>
    
    <!-- Debug Scroll Reveal System -->
    <script>
      // Debug Scroll-Reveal System - Zeigt alle Sections sofort an
      document.addEventListener('DOMContentLoaded', () => {
        console.log('🔍 Debug: Scroll-Reveal System gestartet');
        
        // Finde alle Scroll-Reveal Elemente
        const scrollRevealElements = document.querySelectorAll('[data-scroll-reveal]');
        const scrollRevealGrids = document.querySelectorAll('.scroll-reveal-grid');
        
        console.log(`📊 Gefunden: ${scrollRevealElements.length} Scroll-Reveal Elemente`);
        console.log(`📊 Gefunden: ${scrollRevealGrids.length} Scroll-Reveal Grids`);
        
        // Zeige alle Sections sofort an (ohne Animation)
        scrollRevealElements.forEach((element, index) => {
          console.log(`🎯 Element ${index + 1}:`, element);
          element.classList.add('revealed');
          element.style.opacity = '1';
          element.style.transform = 'none';
        });
        
        // Zeige alle Grid-Sections sofort an
        scrollRevealGrids.forEach((grid, index) => {
          console.log(`🎯 Grid ${index + 1}:`, grid);
          grid.classList.add('revealed');
          grid.style.opacity = '1';
          
          // Zeige auch alle Child-Elemente
          const children = grid.querySelectorAll('.scroll-reveal-child');
          children.forEach(child => {
            child.classList.add('revealed');
            child.style.opacity = '1';
            child.style.transform = 'none';
          });
        });
        
        // Zusätzlich: Zeige alle Sections mit sichtbaren Borders
        const sections = document.querySelectorAll('section');
        sections.forEach((section, index) => {
          console.log(`📦 Section ${index + 1}:`, section);
          section.style.border = '2px solid red';
          section.style.minHeight = '200px';
        });
        
        console.log('✅ Debug: Alle Sections sollten jetzt sichtbar sein');
      });
    </script>
    
    <!-- Lazy Loading Script -->
    <script>
      // Lazy Loading Script for Images
      document.addEventListener('DOMContentLoaded', () => {
        console.log('🖼️ Lazy Loading Script gestartet');
        
        // Alle Bilder sofort sichtbar machen
        const allImages = document.querySelectorAll('img');
        allImages.forEach(img => {
          console.log('🖼️ Bild gefunden:', img.src);
          img.style.opacity = '1';
          img.style.visibility = 'visible';
          img.style.transform = 'translateY(0)';
          img.style.display = 'block';
        });
        
        // Check if Intersection Observer is supported
        if ('IntersectionObserver' in window) {
          const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                const img = entry.target;
                
                // Add loaded class for smooth animation
                img.addEventListener('load', () => {
                  img.classList.add('loaded');
                });
                
                // Stop observing this image
                observer.unobserve(img);
              }
            });
          }, {
            rootMargin: '50px 0px',
            threshold: 0.01
          });

          // Observe all lazy images
          const lazyImages = document.querySelectorAll('img[loading="lazy"]');
          lazyImages.forEach(img => {
            imageObserver.observe(img);
          });
        }
        
        console.log('✅ Alle Bilder sollten jetzt sichtbar sein');
      });
    </script>
  </body>
</html>
